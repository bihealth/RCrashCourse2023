---
title: "R crash course / 05"
author: ""
date: "`r Sys.Date()`"
output:
  ioslides_presentation: 
    widescreen: true
    smaller: true
    css: files/style.css
    logo: files/logo_bihealth_en.png
---

```{r,echo=FALSE,warning=FALSE,message=FALSE}
## Set default options for the knitr RMD processing
knitr::opts_chunk$set(echo=TRUE,eval=FALSE,warning=FALSE,message=FALSE,fig.width=5,fig.height=5,cache=FALSE,autodep=TRUE, results="hide")
knitr::opts_knit$set(root.dir = "../")
```

## Recap for yesterday

## Aims for today

* Combining multiple data sets
* Introduction into statistics with R
* Freestyle - working on your data and questions


## Excercise 4.3 (Recap from yesterday)

The files `expression_data_vaccination_example.xlsx` and
`labresults_full.csv` contain data from the same study.

 1. read the first sheet from the XLSX file and the CSV file.
 3. Which columns ID the subjects? Are there any subjects in common? How do
    you match the subjects?
 5. We are interested only in the following information: Subject ID, ARM
    (group), Time point, sex, age, test name and the actual measurement.
    Are the measurements numeric? Remember, you can use expressions like `[ , c("ARM", "sex") ]` 
    to select the desired columns from a data set.
 4. Use the subjects to merge the two data frames however you see fit. Note
    that there are multiple time points per subject and multiple
    measurements per subject and time point.

## Free style - your questions and projects 

 * Creating pretty tables -> Rmarkdown
    * [Video: introduction R markdown, 15 min](https://youtu.be/vBeGakSENi8)
    * [Video: basic document formatting in Rmarkdown documents, 9 minutes](https://youtu.be/rfMTn4NBDkQ)
    * [Video: including references in Rmarkdown documents, 7 min](https://youtu.be/DUG1tEL5kXI)
    * [kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)
    
## Free style - your questions and projects 

 * heatmap: long vs wide format
   * [pheatmap](https://davetang.github.io/muse/pheatmap.html)
   * [ComplexHeatmap](https://jokergoo.github.io/ComplexHeatmap-reference/book/)
     
## Simple statistics (demo)

 * t.test
 * PCA

## Descriptive statistics

`tapply(x, groups, func)` applies a function `func` to some data `x`
grouped by `groups`.

```{r, eval=TRUE}
library(tidyverse)
labwide <- read_csv("Datasets/labresults_wide_full.csv")[, -1 ]
mean(labwide$NEUT)
sd(labwide$NEUT)

tapply(labwide$NEUT, labwide$ARM, mean)
tapply(labwide$NEUT, labwide$Timepoint, mean)
tapply(labwide$NEUT,
  paste(labwide$ARM, labwide$Timepoint, sep="."), mean)
```

## Simple t.test

We define logical vectors to help us select the desired data.

```{r,eval=TRUE}
fluad    <- labwide$ARM == "FLUAD"
agrippal <- labwide$ARM == "AGRIPPAL"

d0 <- labwide$Timepoint == "D0"
d1 <- labwide$Timepoint == "D1"
```

## Simple t.test

Paired or not paired?

```{r,eval=TRUE}
tst <- "NEUT" # lymphocyte count
x <- as.data.frame(labwide)[,tst]
t.test(x[d0 & fluad], x[d1 & fluad])
t.test(x[d0 & fluad], x[d1 & fluad], paired=TRUE)
```

## Broom: cleaning up data

`tidy()` cleans up messy results of various standard statistical tests and
formats them into a nice, clean, TIDY data frame (or, rather, a tibble).

```{r,eval=TRUE,results="markdown"}
library(broom)
tidy(t.test(x[d0 & fluad], x[d1 & fluad], paired=TRUE))
```

## Caveat: paired data

We must make sure that all the data points are paired!

## PCA

```{r}
data(iris)
theme_set(theme_bw())
pca <- prcomp(iris[,1:4], scale.=TRUE)
df <- data.frame(pca$x, species=iris$Species)
ggplot(df, aes(x=PC1, y=PC2, color=species)) + geom_point()
```

## PCA (cont.)

```{r,eval=TRUE,echo=FALSE}
data(iris)
theme_set(theme_bw())
pca <- prcomp(iris[,1:4], scale.=TRUE)
df <- data.frame(pca$x, species=iris$Species)
ggplot(df, aes(x=PC1, y=PC2, color=species)) + geom_point()
```

## Summary - Let's bring all concepts together

![](images/summaryCourse.png){ width=900px }

## Where to find R packages

* standing on the shoulders of giants
* [CRAN repository](https://cran.r-project.org/)
  * packages for statistics, visualization, machine learning, ...
  * see Task Views for a collection of topics 
  * includes also *tidyverse* universe
* [Bioconductor](http://bioconductor.org/)
  * Tools / Packages for different types of bioinformatic analysis, eg
  * *flowStats*, *flowViz*, ...
  * Guides / Books for workflows, eg
  * [Cytof data](http://bioconductor.org/packages/release/workflows/html/cytofWorkflow.html)

## Where to go from here and where to find help

 * [StackOverflow](https://stackoverflow.com)
 * Walk-in clinic
 * Online R books
   * [Hands-On programming with R](https://rstudio-education.github.io/hopr/)
   * [R for data science (tidyverse)](https://r4ds.had.co.nz/)
   * [R graphics cookbook](https://r-graphics.org/)
   * [R markdown: the definitive guide](https://bookdown.org/yihui/rmarkdown/)
 * Other books:
   * [The R Book](https://www.wiley.com/en-us/The+R+Book%2C+2nd+Edition-p-9780470973929)


